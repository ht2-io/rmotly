name: Assign Copilot to Issues

on:
  issues:
    types: [labeled]

jobs:
  assign-copilot:
    runs-on: ubuntu-latest
    # Only run when the 'copilot' label is added
    if: github.event.label.name == 'copilot'

    permissions:
      issues: write

    steps:
      - name: Assign Copilot to issue
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          REPO: ${{ github.repository }}
        run: |
          echo "Assigning Copilot to issue #${ISSUE_NUMBER}"

          # Use GitHub API to assign Copilot coding agent to the issue
          gh api \
            --method POST \
            -H "Accept: application/vnd.github+json" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "/repos/${REPO}/issues/${ISSUE_NUMBER}/assignees" \
            -f "assignees[]=copilot-swe-agent"

          echo "Successfully assigned Copilot to issue #${ISSUE_NUMBER}"
